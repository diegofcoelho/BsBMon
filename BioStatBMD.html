<!DOCTYPE html>
<html lang="en">
<head>
    <title>Biostat B Process Monitor</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="initial-scale=1"/>
    <script src="/public/jquery.min.js" type="text/javascript"></script>
    <script src="/public/material.min.js"></script>
    <link rel="stylesheet" href="http://fonts.googleapis.com/icon?family=Material+Icons">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,300,300italic,500,400italic,700,700italic'
          rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/public/angular-material.min.css"/>
    <script src="/public/angular.js"></script>
    <script src="/public/angular-animate.min.js"></script>
    <script src="/public/angular-route.min.js"></script>
    <script src="/public/angular-aria.min.js"></script>
    <script src="/public/angular-messages.min.js"></script>
    <script src="/public/angular-material.js"></script>
    <script type="text/javascript" src="/public/gauge.js"></script>
    <script type="text/javascript" src="/public/angular-canvas-gauge.js"></script>
    <script type="text/javascript" src="/public/PercentageGauge.js"></script>
    <link rel="stylesheet" href="/public/biostat.css"/>
    <script src="/public/highcharts.js"></script>
    <script src="/public/highcharts-more.js"></script>
    <script src="/public/modules/solid-gauge.js"></script>
    <script type="text/javascript" src="public/md-data-table.js"></script>
    <link href="public/md-data-table.css" rel="stylesheet" type="text/css"/>
    <link href="public/table.css" rel="stylesheet" type="text/css"/>

</head>

<body layout="column" style="width: 95%; top: 1%; left: 2%;">
<!-- <body layout="column" style="width: 95%; height: 95%; top: 2%; left: 2%;"> -->
<div ng-controller="AppCtrl" ng-app="MyApp" id="appScope">
    <md-tabs md-dynamic-height="" md-border-bottom="">
        <md-tab label="Monitor de Processo">
            <md-grid-list md-cols-xs="4" md-cols-sm="4" md-cols-md="4" md-cols-gt-md="6" md-row-height-gt-md="1.1:1"
                          md-row-height="1:1" md-gutter="12px" md-gutter-gt-sm="8px">
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;" layout="row" layout-align="center center">
                        <p ng-bind="data.time" class="monitors unselectable"></p>
                        <md-grid-tile-footer layout="row" layout-align="center center">
                            <h3>Time</h3>
                        </md-grid-tile-footer>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;" layout="row" layout-align="center center">
                        <p ng-bind="data.temp" class="monitors unselectable"></p>
                        <md-grid-tile-footer layout="row" layout-align="center center">
                            <h3>Temperatura (°C)</h3>
                        </md-grid-tile-footer>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;" layout="row" layout-align="center center">
                        <p ng-bind="data.airflow" class="monitors unselectable"></p>
                        <md-grid-tile-footer layout="row" layout-align="center center">
                            <h3>AirFlow (L/min)</h3>
                        </md-grid-tile-footer>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;" layout="row" layout-align="center center">
                        <p ng-bind="data.ph" class="monitors unselectable"></p>
                        <md-grid-tile-footer layout="row" layout-align="center center">
                            <h3>pH</h3>
                        </md-grid-tile-footer>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile class="gray" md-rowspan="2" md-colspan="2">
                    <md-card style="width: 100%;height: 95%;" layout="row" layout-align="center center">
                        <canvas canvas-gauge
                                id="myCanvas"
                                width="{{gauge.width}}"
                                height="{{gauge.height}}"
                                data-value="{{data.rotation}}"
                                data-title="Rotação"
                                data-min-value="0"
                                data-max-value="1100"
                                data-major-ticks="0 100 200 300 400 500 600 700 800 900 1000 1100"
                                data-minor-ticks="2"
                                data-stroke-ticks="true"
                                data-units="rpm"
                                data-value-format="4.0"
                                data-glow="true"
                                data-animation-delay="10"
                                data-animation-duration="200"
                                data-animation-fn="bounce"
                                data-colors-needle="#f00 #00f"
                                data-highlights="0 100 #eee, 100 650 #ccc, 650 900 #aaa, 900 1100 #eaa"
                                data-circles-outervisible="true"
                                data-circles-middlevisible="true"
                                data-circles-innervisible="true"
                                data-valuebox-visible="true"
                                data-valuetext-visible="true"
                                data-colors-needle-start="rgba(240, 128, 128, 1)"
                                data-colors-needle-end="rgba(255, 160, 122, .9)"
                                data-colors-needle-shadowup="rgba(2, 255, 255, 0.2)"
                                data-colors-needle-shadowdown="rgba(188, 143, 143, 0.45)"
                                data-colors-needle-circle-outerstart="#f0f0f0"
                                data-colors-needle-circle-outerend="#ccc"
                                data-colors-needle-circle-innerstart="#e8e8e8"
                                data-colors-needle-circle-innerend="#f5f5f5"
                                data-colors-valuebox-rectstart="#888"
                                data-colors-valuebox-rectend="#666"
                                data-colors-valuebox-background="#babab2"
                                data-colors-valuebox-shadow="rgba(0, 0, 0, 1)"
                                data-colors-valuetext-foreground="#444"
                                data-colors-valuetext-shadow="rgba(0, 0, 0, 0.3)"
                                data-colors-circle-shadow="rgba(0, 0, 0, 0.3)"
                                data-colors-circle-outerstart="#ddd"
                                data-colors-circle-outerend="#aaa"
                                data-colors-circle-middlestart="#eee"
                                data-colors-circle-middleend="#f0f0f0"
                                data-colors-circle-innerstart="#fafafa"
                                data-colors-circle-innerend="#ccc"
                        ></canvas>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;" layout="row" layout-align="center center">
                        <p ng-bind="data.level" class="monitors unselectable"></p>
                        <md-grid-tile-footer layout="row" layout-align="center center">
                            <h3>Level (mL)</h3>
                        </md-grid-tile-footer>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;" layout="row" layout-align="center center">
                        <p ng-bind="data.afoam" class="monitors unselectable"></p>
                        <md-grid-tile-footer layout="row" layout-align="center center">
                            <h3>AFOAM (%)</h3>
                        </md-grid-tile-footer>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;" layout="row" layout-align="center center">
                        <p ng-bind="data.subs1t" class="monitors unselectable"></p>

                        <md-grid-tile-footer layout="row" layout-align="center center">
                            <h3>SUBS 1T</h3>
                        </md-grid-tile-footer>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;" layout="row" layout-align="center center">
                        <p ng-bind="data.subs2t" class="monitors unselectable"></p>
                        <md-grid-tile-footer layout="row" layout-align="center center">
                            <h3>SUBS 2T</h3>
                        </md-grid-tile-footer>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;">
                        <div id="subs1" style="width:16%; height: 26%;"></div>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;">
                        <div id="subs2" style="width:16%; height: 26%;"></div>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;">
                        <div id="acid" style="width:16%; height: 26%;"></div>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;">
                        <div id="base" style="width:16%; height: 26%;"></div>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;">
                        <div id="gasmx" style="width:16%; height: 26%;"></div>
                    </md-card>
                </md-grid-tile>
                <md-grid-tile>
                    <md-card style="width: 100%;height: 90%;">
                        <div id="po2" style="width:16%; height: 26%;"></div>
                    </md-card>
                </md-grid-tile>

            </md-grid-list>
        </md-tab>
        <md-tab label="Configurações">
            <md-card  style="padding: 2%;height: 85vh;">
                <md-switch ng-model="logger" aria-label="Switch 1">
                    Gravar Dados: {{ logger }}
                </md-switch>
            </md-card>
        </md-tab>
        <md-tab label="Base de dados">
            <md-content laout="column" flex ng-controller="dataController">
                <md-card ng-include="'templates/data-table.html'" style="padding: 2%;height: 85vh;"></md-card>
            </md-content>
        </md-tab>
    </md-tabs>

    <!-- angular.element($0).parent().scope().data -->

</div>
<script type="text/javascript">

    angular.module('MyApp', ['ngMaterial', 'ngMessages', 'angular-canvas-gauge', 'md.data.table'])

            .config(['$mdThemingProvider', function ($mdThemingProvider) {
                'use strict';

                $mdThemingProvider.theme('default')
                  .primaryPalette('blue')
                  .accentPalette('pink');
              }])

            .controller('AppCtrl', function ($scope) {
                $scope.data = {};
                $scope.data.time = "00:00";
                $scope.data.temp = 0;
                $scope.data.rotation = 0;
                $scope.data.ph = 0;
                $scope.data.po2 = 0;
                $scope.data.acid = 0;
                $scope.data.base = 0;
                $scope.data.afoam = 0;
                $scope.data.level = 0;
                $scope.data.subs1 = 0;
                $scope.data.subs1t = 0;
                $scope.data.subs2 = 0;
                $scope.data.subs2t = 0;
                $scope.data.gasmx = 0;
                $scope.data.airflow = 0;
                $scope.data.flhoeimv = 0;

                $scope.table = []
                $scope.tcount = 0

                $scope.gauge = {
                    value: 50,
                    width: 350,
                    height: 350
                };
            })

            .controller('dataController', ['$http', '$mdEditDialog', '$q', '$timeout', '$scope', function ($http, $mdEditDialog, $q, $timeout, $scope) {
              'use strict';

              $scope.options = {
                rowSelection: false,
                multiSelect: false,
                autoSelect: false,
                decapitate: false,
                largeEditDialog: false,
                boundaryLinks: false,
                limitSelect: false,
                pageSelect: false
              };

              $scope.selected = [];
              $scope.limitOptions = [5, 10, 15, {
                label: 'All',
                value: function () {
                  return $scope.table ? $scope.table.length : 0;
                }
              }];

              $scope.query = {
                order: 'name',
                limit: 14,
                page: 1
              };

              // for testing ngRepeat
              $scope.columns = [{
                name: 'Hora',
                orderBy: 'name',
                unit: '(HH:MM)'
              }, {
                descendFirst: true,
                name: 'Type',
                orderBy: 'type'
              }, {
                name: 'Calories',
                numeric: true,
                orderBy: 'calories.value'
              }, {
                name: 'Fat',
                numeric: true,
                orderBy: 'fat.value',
                unit: 'g'
              }, /* {
                name: 'Carbs',
                numeric: true,
                orderBy: 'carbs.value',
                unit: 'g'
              }, */ {
                name: 'Protein',
                numeric: true,
                orderBy: 'protein.value',
                trim: true,
                unit: 'g'
              }, /* {
                name: 'Sodium',
                numeric: true,
                orderBy: 'sodium.value',
                unit: 'mg'
              }, {
                name: 'Calcium',
                numeric: true,
                orderBy: 'calcium.value',
                unit: '%'
              }, */ {
                name: 'Iron',
                numeric: true,
                orderBy: 'iron.value',
                unit: '%'
              }, {
                name: 'Comments',
                orderBy: 'comment'
              }];

              $http.get('templates/desserts.json').then(function (desserts) {
                $scope.desserts = desserts.data;

              });

              $scope.editComment = function (event, dessert) {
                event.stopPropagation();

                var dialog = {
                  // messages: {
                  //   test: 'I don\'t like tests!'
                  // },
                  modelValue: dessert.comment,
                  placeholder: 'Add a comment',
                  save: function (input) {
                    dessert.comment = input.$modelValue;
                  },
                  targetEvent: event,
                  title: 'Add a comment',
                  validators: {
                    'md-maxlength': 30
                  }
                };

                var promise = $scope.options.largeEditDialog ? $mdEditDialog.large(dialog) : $mdEditDialog.small(dialog);

                promise.then(function (ctrl) {
                  var input = ctrl.getInput();

                  input.$viewChangeListeners.push(function () {
                    input.$setValidity('test', input.$modelValue !== 'test');
                  });
                });
              };

              $scope.toggleLimitOptions = function () {
                $scope.limitOptions = $scope.limitOptions ? undefined : [5, 10, 15];
              };

              $scope.getTypes = function () {
                return ['Candy', 'Ice cream', 'Other', 'Pastry'];
              };

              $scope.onPaginate = function(page, limit) {
                console.log('Scope Page: ' + $scope.query.page + ' Scope Limit: ' + $scope.query.limit);
                console.log('Page: ' + page + ' Limit: ' + limit);

                $scope.promise = $timeout(function () {

                }, 2000);
              };

              $scope.deselect = function (item) {
                console.log(item.name, 'was deselected');
              };

              $scope.log = function (item) {
                console.log(item.name, 'was selected');
              };

              $scope.loadStuff = function () {
                $scope.promise = $timeout(function () {

                }, 2000);
              };

              $scope.onReorder = function(order) {

                console.log('Scope Order: ' + $scope.query.order);
                console.log('Order: ' + order);

                $scope.promise = $timeout(function () {

                }, 2000);
              };

            }]);

    document.addEventListener('DOMContentLoaded', function () {
        var timeSrc = new EventSource('feed');
        timeSrc.addEventListener('time', function (event) {
            /*document.getElementById("Test").innerHTML += "\n " + event.data;*/
            var $scope = $("#appScope").scope();
            $scope.$apply(function () {
                $scope.data = eval('(' + event.data + ')');
            });
            $('#po2').highcharts().series[0].points[0].update(parseFloat($scope.data.po2));
            $('#base').highcharts().series[0].points[0].update(parseFloat($scope.data.base));
            $('#subs1').highcharts().series[0].points[0].update(parseFloat($scope.data.subs1));
            $('#subs2').highcharts().series[0].points[0].update(parseFloat($scope.data.subs2));
            $('#acid').highcharts().series[0].points[0].update(parseFloat($scope.data.acid));
            $('#gasmx').highcharts().series[0].points[0].update(parseFloat($scope.data.gasmx));
            $scope.table.push($scope.data);
            $scope.tcount = $scope.table.length;
        });
    }, false);
</script>
</body>
</html>